{% load static card_database_tags %}
<div class="card-container">
    <div class="card-left-half">
        {% if card.card_image %}
            <img class="card-img" src="{{ card.card_image.url }}">
        {% else %}
            Image Missing
            <!-- Adding a placeholder cardback image in case a real card image is not available, just to show something -->
            <img class="card-img" src="{% static 'img/fow_cardback.png' %}">
        {% endif %}
    </div>
    <div class="card-right-half">
        <div class="card-text-info">
            <div class="card-text-info-title">
                Name:
            </div>
            <div class="card-text-info-text">
                {{ card.name }}
            </div>
        </div>
        <div class="card-text-info">
            <div class="card-text-info-title">
                Type(s):
            </div>
            <div class="card-text-info-text">
                {% for card_type in card.types.all %}
                    <a href='/search?card_type={{ card_type.name }}&form_type=advanced-form'>{{ card_type.name }}</a>{% if not forloop.last %},{% endif %}
                {% endfor %}
            </div>
        </div>
        {% if not card.cost == None %}
            <div class="card-text-info">
                <div class="card-text-info-title">
                    Cost:
                </div>
                <div class="card-text-info-text">
                    {%  format_cost_text card.cost %}
                </div>
            </div>
        {% endif %}
        {% if card.colours.all %}
            <div class="card-text-info">
                <div class="card-text-info-title">
                    Attribute(s):
                </div>
                <div class="card-text-info-text">
                    {% for colour in card.colours.all %}
                        <a href='/search?colours={{ colour.db_representation }}&form_type=advanced-form'>{% format_attribute_text colour.db_representation %}</a>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
        {% if card.races.all %}
            <div class="card-text-info">
                <div class="card-text-info-title">
                    Race/Trait(s):
                </div>
                <div class="card-text-info-text">
                    {% for race in card.races.all %}
                        <a href='/search?race={{ race.name }}&form_type=advanced-form'>{{ race.name }}</a>{% if not forloop.last %},{% endif %}
                    {% endfor %}
                </div>
            </div>
        {% endif %}
        {% if not card.ATK == None %}
            <div class="card-text-info">
                <div class="card-text-info-title">
                    ATK:
                </div>
                <div class="card-text-info-text">
                    {{ card.ATK }}
                </div>
            </div>
        {% endif %}
        {% if not card.DEF == None %}
            <div class="card-text-info">
                <div class="card-text-info-title">
                    DEF:
                </div>
                <div class="card-text-info-text">
                    {{ card.DEF }}
                </div>
            </div>
        {% endif %}
        {% if not card.divinity == None %}
            <div class="card-text-info">
                <div class="card-text-info-title">
                    Divinity:
                </div>
                <div class="card-text-info-text">
                    {{ card.divinity }}
                </div>
            </div>
        {% endif %}
        {% if card.ability_texts.all %}
            <div class="card-text-info ability-text">
                <div class="card-text-info-title">
                    Text:
                </div>
                {% order_card_abilities card as abilities %}
                {% for ability in abilities %}
                    <div class="card-text-info-text">
                        {% format_ability_text ability %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        {% if not card.flavour == None %}
            <div class="card-text-info">
                <div class="card-text-info-title">
                    Flavour:
                </div>
                <div class="card-text-info-text less-important-text">
                    {{ card.flavour }}
                </div>
            </div>
        {% endif %}
        <div class="card-text-info">
            <div class="card-text-info-title">
                Set:
            </div>
            <div class="card-text-info-text">
                {% if set_name %}
                    <a href='/search?sets={{ set_code }}&form_type=advanced-form'>{{ set_name }} ({{set_code}})
                {% else %}
                    {{ set_code }}
                {% endif %}
                </a>
            </div>
        </div>
        <div class="card-text-info">
            <div class="card-text-info-title">
                ID:
            </div>
            <div class="card-text-info-text">
                {% format_id_text  card.card_id %}
            </div>
        </div>
        {% if card.rarity %}
            <div class="card-text-info">
                <div class="card-text-info-title">
                    Rarity:
                </div>
                <div class="card-text-info-text">
                    <a href='/search?rarity={{ card.rarity }}&form_type=advanced-form'>{{ card.rarity }}</a>
                </div>
            </div>
        {% endif %}
        {% if referred_by %}
            <div id="referred-by">
                <div class="referred-by-title">
                    This card is referenced by:
                </div>
                {% for card_referred_by in referred_by.distinct %}
                    <div class="referred-card">
                        <a href="{% card_id_to_url card_referred_by.card_id %}">
                            <div class="referenced-card">
                                {{ card_referred_by.name }}                                
                                {% if card_referred_by.card_image %}
                                    {% referenced_card_img_html card_referred_by %}
                                {% else %}
                                    Image Missing
                                {% endif %}                                
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        {% if card.rulings %}
            <div class="card-text-info">
                <div class="judge-rulings-title card-text-info-title">
                    Rulings:
                </div>
                {% for ruling in card.rulings %}
                    <div class="ruling-container">
                        {% if ruling.company_confirmed %}
                            <div class="confirmation-icon-container">
                                <img class="company-confirmation-icon" src="{% static 'img/public-icon.png' %}">
                                <div class="tooltip-container">
                                    <span class="tooltip-hover">Confirmed by company officials</span>
                                </div>
                            </div>
                        {% endif %}
                        {% embed_text_with_card_urls ruling.text as processed_ruling %}
                        <div class="card-info-text judge-ruling">{% for text in processed_ruling %}{{ text }}{% endfor %}</div>
                        <div class="ruling-info">
                            - <a href="{% url 'cardDatabase-view-users-decklist' ruling.added_by.user.username %}">
                                {{ ruling.added_by.user.username }}
                            </a>, <div class="bold-ruling-text">{{ ruling.last_modified|date:"d M Y" }}</div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        {% if referred_decklists %}
            <div id="card-decklists" class="card-text-info">
                <div class="decklist-title card-text-info-title">Recent Decks: </div>
                {% for decklist in referred_decklists %}
                    <div class="decklist-link">
                        <a href="{% url 'cardDatabase-view-decklist' decklist.pk %}">{{ decklist.name }}</a> by <a href="{% url 'cardDatabase-view-users-decklist' decklist.profile.user.username %}">{{ decklist.profile.user.username }}</a>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>